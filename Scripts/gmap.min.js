/**
 * jQuery gMap - Google Maps API V3
 *
 * @license MIT License; http://www.opensource.org/licenses/mit-license.php
 * @url   http://github.com/marioestrada/jQuery-gMap
 * @author  Mario Estrada <me@mario.ec> based on original plugin by Cedric Kastner <cedric@nur-text.de>
 * @version 2.1.5
 */
/* global google */
(function (a) { a.fn.gMap = function (b, d) { switch (b) { case "addMarker": return a(this).trigger("gMap.addMarker", [d.latitude, d.longitude, d.content, d.icon, d.popup]); case "centerAt": return a(this).trigger("gMap.centerAt", [d.latitude, d.longitude, d.zoom]); case "clearMarkers": return a(this).trigger("gMap.clearMarkers") } var c = a.extend({}, a.fn.gMap.defaults, b); return this.each(function () { var f = new google.maps.Map(this); a(this).data("gMap.reference", f); var q = new google.maps.Geocoder(); if (c.address) { q.geocode({ address: c.address }, function (r, j) { if (r && r.length) { f.setCenter(r[0].geometry.location) } }) } else { if (c.latitude && c.longitude) { f.setCenter(new google.maps.LatLng(c.latitude, c.longitude)) } else { if (a.isArray(c.markers) && c.markers.length > 0) { if (c.markers[0].address) { q.geocode({ address: c.markers[0].address }, function (r, j) { if (r && r.length > 0) { f.setCenter(r[0].geometry.location) } }) } else { f.setCenter(new google.maps.LatLng(c.markers[0].latitude, c.markers[0].longitude)) } } else { f.setCenter(new google.maps.LatLng(34.885931, 9.84375)) } } } f.setZoom(c.zoom); f.setMapTypeId(google.maps.MapTypeId[c.maptype]); var n = { scrollwheel: c.scrollwheel, disableDoubleClickZoom: !c.doubleclickzoom }; if (c.controls === false) { a.extend(n, { disableDefaultUI: true }) } else { if (c.controls.length !== 0) { a.extend(n, c.controls, { disableDefaultUI: true }) } } f.setOptions(n); var l = new google.maps.Marker(); var m; var p; m = new google.maps.MarkerImage(c.icon.image); m.size = new google.maps.Size(c.icon.iconsize[0], c.icon.iconsize[1]); m.anchor = new google.maps.Point(c.icon.iconanchor[0], c.icon.iconanchor[1]); l.setIcon(m); if (c.icon.shadow) { p = new google.maps.MarkerImage(c.icon.shadow); p.size = new google.maps.Size(c.icon.shadowsize[0], c.icon.shadowsize[1]); p.anchor = new google.maps.Point(c.icon.shadowanchor[0], c.icon.shadowanchor[1]); l.setShadow(p) } a(this).bind("gMap.centerAt", function (s, t, r, j) { if (j) { f.setZoom(j) } f.panTo(new google.maps.LatLng(parseFloat(t), parseFloat(r))) }); var e = []; a(this).bind("gMap.clearMarkers", function () { while (e[0]) { e.pop().setMap(null) } }); var i; a(this).bind("gMap.addMarker", function (v, x, j, w, y, r) { var z; var A; var s = new google.maps.LatLng(parseFloat(x), parseFloat(j)); var u = new google.maps.Marker({ position: s }); if (y) { z = new google.maps.MarkerImage(y.image); z.size = new google.maps.Size(y.iconsize[0], y.iconsize[1]); z.anchor = new google.maps.Point(y.iconanchor[0], y.iconanchor[1]); u.setIcon(z); if (y.shadow) { A = new google.maps.MarkerImage(y.shadow); A.size = new google.maps.Size(y.shadowsize[0], y.shadowsize[1]); A.anchor = new google.maps.Point(y.shadowanchor[0], y.shadowanchor[1]); l.setShadow(A) } } else { u.setIcon(l.getIcon()); u.setShadow(l.getShadow()) } if (w) { if (w === "_latlng") { w = x + ", " + j } var t = new google.maps.InfoWindow({ content: c.html_prepend + w + c.html_append }); google.maps.event.addListener(u, "click", function () { if (i) { i.close() } t.open(f, u); i = t }); if (r) { google.maps.event.addListenerOnce(f, "tilesloaded", function () { t.open(f, u) }) } } u.setMap(f); e.push(u) }); var h; var o = this; var k = function (j) { return function (s, r) { if (s && s.length > 0) { a(o).trigger("gMap.addMarker", [s[0].geometry.location.lat(), s[0].geometry.location.lng(), j.html, j.icon, j.popup]) } } }; for (var g = 0; g < c.markers.length; g++) { h = c.markers[g]; if (h.address) { if (h.html === "_address") { h.html = h.address } q.geocode({ address: h.address }, k(h)) } else { a(this).trigger("gMap.addMarker", [h.latitude, h.longitude, h.html, h.icon, h.popup]) } } }) }; a.fn.gMap.defaults = { address: "", latitude: 0, longitude: 0, zoom: 1, markers: [], controls: [], scrollwheel: false, doubleclickzoom: true, maptype: "ROADMAP", html_prepend: '<div class="gmap_marker">', html_append: "</div>", icon: { image: "http://www.google.com/mapfiles/marker.png", shadow: "http://www.google.com/mapfiles/shadow50.png", iconsize: [20, 34], shadowsize: [37, 34], iconanchor: [9, 34], shadowanchor: [6, 34] } } })(jQuery);